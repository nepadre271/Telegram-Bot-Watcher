import logging

from aiogram import Router, Bot
from aiogram.filters import Command
from aiogram.types import Message

from bot.utils import is_user_subscribed
from bot.keyboards.reply import main_menu
from bot.keyboards.inline import unsub
from bot.settings import settings

router = Router()
logger = logging.getLogger(__name__)


@router.message(Command("start"))
async def cmd_start(message: Message, bot: Bot):
    logger.info("–û–±—Ä–∞–±–æ—Ç—á–∏–∫ cmd_start –≤—ã–∑–≤–∞–Ω")
    user_id = message.from_user.id
    channel_id = settings.chat_id
    if await is_user_subscribed(bot, user_id, channel_id):
        logger.info("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª")
        text = f"<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {message.from_user.first_name}!</b>\n\n" + \
               "üì∫ –í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ª—É—á—à–µ–º –±–æ—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤ –ø—Ä—è–º–æ –≤ Telegram!\n\n" + \
               "–°–º–æ—Ç—Ä–∏—Ç–µ —Å–µ—Ä–∏–∞–ª—ã –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ, –ø–ª–∞–Ω—à–µ—Ç–µ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ." + \
               "–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–µ—Ä–∏—è—Ö. –°–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–µ—Ä–∏–∞–ª—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∂–∞–Ω—Ä–∞–º –∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º." + \
               "–°–∫–∞—á–∏–≤–∞–π—Ç–µ —Å–µ—Ä–∏–∞–ª—ã —Å–µ–±–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.\n\n" + \
               "<i>–ò—Å–ø–æ–ª—å–∑—É—è –±–æ—Ç–∞, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ, —á—Ç–æ –±—É–¥–µ—Ç–µ —Å–æ–±–ª—é–¥–∞—Ç—å –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–µ—Ä–∏–∞–ª–æ–≤.</i>"

        markup = main_menu()

    else:
        logger.info("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –∫–∞–Ω–∞–ª")
        text = f"<b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {message.from_user.first_name}!</b>\n\n" + \
               "–ß—Ç–æ–±—ã –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É —Å–µ—Ä–∏–∞–ª–æ–≤ –≤ –±–æ—Ç–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª " + \
               "‚Äî –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ!üëá\n\n" + \
               "–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –æ–±—Ä–∞—Ç–Ω–æ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ü—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É¬ª. \n\n" + \
               "<i>–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤–∞—Å –∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π! –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å!</i>"

        markup = unsub()

    await message.answer(
        text,
        parse_mode="html",
        reply_markup=markup
    )
    logger.info("–û–±—Ä–∞–±–æ—Ç—á–∏–∫ cmd_start –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É")
